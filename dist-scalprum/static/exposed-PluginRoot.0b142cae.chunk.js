(self.webpackChunkplugin_web_rca=self.webpackChunkplugin_web_rca||[]).push([[879],{51271:(e,t,n)=>{"use strict";n.d(t,{S:()=>p});var i=n(74848),r=(n(28437),n(94066)),c=n(24705),a=n(22097),o=n(54392),s=n(81067);const d=JSON.parse('{"kind":"IncidentList","page":1,"size":3,"total":3,"items":[{"id":"587c93df-3715-4a34-a0f3-be76a1335717","kind":"Incident","href":"/api/web-rca/v1/incidents/587c93df-3715-4a34-a0f3-be76a1335717","incident_id":"ITN-2023-21443","summary":"Incident Working Time Quay Test 2","description":"Second test for the incident_product_working_time metric by creating test incident."},{"id":"8ceac8ec-a327-4134-99f1-5e497a51fb84","kind":"Incident","href":"/api/web-rca/v1/incidents/8ceac8ec-a327-4134-99f1-5e497a51fb84","incident_id":"ITN-2023-21523","summary":"Incident Working Time Quay Test 3","description":"Testing the incidents_product_working_time metric with a Quay product."},{"id":"52ab70a5-14d7-4516-ad6c-f2923beac9c5","kind":"Incident","href":"/api/web-rca/v1/incidents/52ab70a5-14d7-4516-ad6c-f2923beac9c5","incident_id":"ITN-2023-21440","summary":"Incident Working Time Quay Test","description":"Testing the incident_products_working_time metric by creating test incident."}]}'),l=({incidents:e,web_rca_url:t,message:n})=>{if(!n&&e&&e.items&&0!==e.items.length||(e=d),!e||!e.items||0===e.items.length)return(0,i.jsx)(r.nO,{title:"Web RCA Incidents",children:(0,i.jsx)(o.A,{variant:"body1",children:"Error fetching incidents: "+n})});const c=e.items.map((e=>({incident_id:(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:`${t}/incident/${e.incident_id}/events`,children:e.incident_id}),summary:e.summary,description:e.description})));return(0,i.jsx)(r.XI,{title:"Web RCA Incidents",options:{search:!0,paging:!0,pageSize:10},columns:[{title:"ID",field:"incident_id"},{title:"Summary",field:"summary"},{title:"Description",field:"description"}],data:c})};async function u(e,t,n){return await fetch(`${e}/api/proxy/status-board/products?search=fullname+ilike+'${n}'`,{headers:{Authorization:`Bearer ${t}`}}).catch((e=>e)).then((e=>e.json()))}const p=({product:e})=>{const t=(0,a.useApi)(a.configApiRef),n=(0,a.useApi)(a.identityApiRef),o=(0,s.u)(),{value:d,loading:p,error:g}=(0,c.A)((async()=>{const i=await n.getProfileInfo().then((e=>e));console.log(i);const r=await n.getBackstageIdentity().then((e=>e));console.log(r);const c=await n.getCredentials().then((e=>(console.log(e),console.log(e.token),e.token)));if(void 0===c)return"Invalid token";let a;console.log(c);try{a=await async function(e,t){const n={grant_type:"refresh_token",client_id:"cloud-services",refresh_token:`${t}`},i=[];for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const t=encodeURIComponent(e),r=encodeURIComponent(n[e]);i.push(`${t}=${r}`)}const r=i.join("&");return await fetch(`${e}/api/proxy/sso-redhat/auth/realms/redhat-external/protocol/openid-connect/token`,{method:"POST",body:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).catch((e=>e)).then((e=>e.json()))}(t.getString("backend.baseUrl"),c)}catch(e){return console.log("Error: ",e),"Invalid token"}if(console.log("Token: ",a),a.error)return a.error_description;let s="";if(e){const n=await u(t.getString("backend.baseUrl"),a.access_token,e);n.items&&n.items.length>0&&(s=`?product_id=${n.items[0].id}`)}if(o){const e=await u(t.getString("backend.baseUrl"),a.access_token,o.entity.metadata.name);e.items.length>0&&(s=`?product_id=${e.items[0].id}`)}return""===s?"No product based on entity":fetch(`${t.getString("backend.baseUrl")}/api/proxy/web-rca/incidents${s}`,{headers:{Authorization:`Bearer ${a.access_token}`}}).then((e=>e.json())).catch((e=>e))}),[]);return p?(0,i.jsx)(r.ke,{}):g?(0,i.jsx)(r._1,{error:g}):d?"string"==typeof d?(0,i.jsx)(l,{message:d,web_rca_url:t.getString("ocm.web-rca-url")}):(0,i.jsx)(l,{incidents:d,web_rca_url:t.getString("ocm.web-rca-url")}):(0,i.jsx)(r._1,{error:{name:"Foo",message:"Foo"}})}},66477:(e,t,n)=>{"use strict";n.r(t),n.d(t,{WebRCAFetchComponent:()=>o.S,WebRcaPage:()=>a,webRcaPlugin:()=>c});var i=n(22097);const r=(0,i.createRouteRef)({id:"web-rca"}),c=(0,i.createPlugin)({id:"web-rca",routes:{root:r}}),a=c.provide((0,i.createRoutableExtension)({name:"WebRcaPage",component:()=>n.e(9623).then(n.bind(n,99623)).then((e=>e.WebRCAComponent)),mountPoint:r}));var o=n(51271)},42634:()=>{}}]);
//# sourceMappingURL=exposed-PluginRoot.0b142cae.chunk.js.map